#!/bin/bash
declare -A dirs
declare -A results
dirs["Backups"]=""
dirs["Books"]=""
dirs["Comics"]=""
dirs["Home"]=""
dirs["Movies"]=""
dirs["Music"]=""
dirs["Pictures"]="--exclude thumbnail --exclude .thumbcache --exclude thumbnails-digikam.db --exclude thumbnails-digikam.db-journal --exclude .dtrash"
dirs["pv"]=""
dirs["Roms"]=""
dirs["Stuff"]="--exclude Home/.ignore --exclude Home/.cache --exclude Home/.mozilla"
dirs["Television"]=""
dirs["Virtual"]=""
dirs["Volumes"]="--exclude immich/thumbs --exclude immich/encoded-video"

echo -n "Update ${1}? "
read -r CHECK
sudo mount "$1" /mnt
MNT=/mnt
if [ "$CHECK" != "n" ]; then
  for DIR in "${!dirs[@]}"; do
    if [ -n "$2" ] && [ "$2" != "$DIR" ]; then continue;fi
    echo "Updating $DIR with options: ${dirs[$DIR]}"
    ionice -c 3 sudo rsync -av --delete-during ${dirs[$DIR]} "/tank/${DIR}/" "${MNT}/${DIR}/"
    results[$DIR]="$?"
  done
fi
echo Return codes:
for DIR in "${!dirs[@]}"; do
  echo "$DIR ${results[$DIR]}"
done
sudo umount /mnt
echo Done
